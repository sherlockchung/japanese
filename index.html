<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æª¢ N2/N3 å–®å­—ç‰¹è¨“ (å®Œæ•´æ“´å……ç‰ˆ)</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --success: #10b981;
            --error: #ef4444;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Hiragino Sans', 'Meiryo', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 650px;
            border-radius: 20px;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1 {
            color: var(--primary);
            margin: 0 0 10px 0;
            font-size: 1.8rem;
        }

        .subtitle {
            color: #64748b;
            font-size: 0.95rem;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        /* é€²åº¦æ¢å€åŸŸ */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .progress-track {
            width: 100%;
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 99px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.4s ease-out;
        }

        /* é¡Œç›®å¡ç‰‡ */
        .card {
            background: #f1f5f9;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 40px 20px;
            margin-bottom: 25px;
            position: relative;
        }

        .tag {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary);
            color: white;
            padding: 6px 16px;
            border-radius: 99px;
            font-size: 0.85rem;
            font-weight: bold;
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.3);
        }

        .word-display {
            font-size: 3rem;
            font-weight: 800;
            color: #0f172a;
            margin-top: 10px;
            letter-spacing: 2px;
        }

        /* é¸é …ç¶²æ ¼ */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 500px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            .word-display {
                font-size: 2.2rem;
            }
        }

        button.option-btn {
            background-color: white;
            border: 2px solid #cbd5e1;
            color: var(--text);
            padding: 16px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button.option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background-color: #eef2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }

        button.option-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        button.option-btn.correct {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }

        button.option-btn.wrong {
            background-color: var(--error);
            color: white;
            border-color: var(--error);
            opacity: 0.8;
        }

        .feedback {
            height: 24px;
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* ç‹€æ…‹åˆ‡æ› */
        .hidden { display: none !important; }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        #result-stats {
            margin: 20px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            text-align: left;
            display: inline-block;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div id="start-screen">
        <h1>å–®å­—å¼±é»ç‰¹è¨“</h1>
        <div class="subtitle">
            å·²è¼‰å…¥ 200+ å€‹ä¾†è‡ªæ‚¨ç­†è¨˜çš„å–®å­—<br>
            åŒ…å«ï¼šå®¶äº‹ã€èº«é«”ã€æ€§æ ¼ã€å­¸æ¥­èˆ‡æ˜“éŒ¯å­—
        </div>
        <div style="margin-bottom: 30px; color: #64748b; font-size: 0.9rem;">
            æ¸¬é©—è¦å‰‡ï¼š<br>
            â€¢ æ¯æ¬¡éš¨æ©ŸæŠ½å‡º 20 é¡Œ (10é¡Œè®€éŸ³ + 10é¡Œæ„æ€)<br>
            â€¢ ç­”éŒ¯æœƒé¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆï¼Œä¸¦é‡æ–°æ’å…¥éšŠåˆ—ç›´åˆ°ç­”å°
        </div>
        <button class="btn-primary" onclick="startQuiz()">é–‹å§‹ç‰¹è¨“</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="stats-bar">
            <span id="progress-text">é€²åº¦: 0 / 20</span>
            <span id="queue-count">å‰©é¤˜é¡Œç›®: 20</span>
        </div>
        <div class="progress-track">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div class="card">
            <div class="tag" id="q-type"></div>
            <div class="word-display" id="q-word"></div>
        </div>

        <div class="options-grid" id="options-container"></div>
        <div class="feedback" id="feedback-msg"></div>
    </div>

    <div id="result-screen" class="hidden">
        <h1 style="color: var(--success);">ç‰¹è¨“å®Œæˆï¼</h1>
        <p>æ‰€æœ‰é¡Œç›®éƒ½å·²æ­£ç¢ºå›ç­”ã€‚</p>
        
        <div id="result-stats">
            <div>ğŸ“Š ç¸½é¡Œç›®æ•¸ï¼š20</div>
            <div id="final-wrongs"></div>
        </div>
        <br>
        <button class="btn-primary" onclick="location.reload()">å†æ¸¬é©—ä¸€è¼ª</button>
    </div>

</div>

<script>
    // å®Œæ•´çš„å–®å­—è³‡æ–™åº« (åŒ…å«æ‹†è§£å¾Œçš„å–®å­—)
    const rawData = [
        // å®¶äº‹é¡
        {kanji: "æ¯›ç³¸", kana: "ã‘ã„ã¨", meaning: "æ¯›ç·š"},
        {kanji: "ç·¨ã‚€", kana: "ã‚ã‚€", meaning: "ç·¨ç¹”"},
        {kanji: "å¹²ã™", kana: "ã»ã™", meaning: "æ›¬/æ™¾"},
        {kanji: "ä¹¾ã‹ã™", kana: "ã‹ã‚ã‹ã™", meaning: "å¼„ä¹¾"},
        {kanji: "æ•£ã‚‰ã‹ã‚‹", kana: "ã¡ã‚‰ã‹ã‚‹", meaning: "æ•£äº‚/å‡Œäº‚"},
        {kanji: "é€€ã‘ã‚‹", kana: "ã©ã‘ã‚‹", meaning: "ç§»é–‹/æŒªé–‹"},
        {kanji: "åŸƒ", kana: "ã»ã“ã‚Š", meaning: "ç°å¡µ"},
        {kanji: "ç®’", kana: "ã»ã†ã", meaning: "æƒæŠŠ"},
        {kanji: "å¡µå–ã‚Š", kana: "ã¡ã‚Šã¨ã‚Š", meaning: "ç•šç®•"},
        {kanji: "åŠã‚‹ã™", kana: "ã¤ã‚‹ã™", meaning: "åŠæ›"},
        {kanji: "èŒ¹ã§ã‚‹", kana: "ã‚†ã§ã‚‹", meaning: "ç‡™/ç…®(è”¬èœ/è›‹)"},
        {kanji: "ç‚’ã‚‹", kana: "ã„ã‚‹", meaning: "ç‚’/ç…/çƒ˜ç„™"},
        {kanji: "ç‚’ã‚ã‚‹", kana: "ã„ãŸã‚ã‚‹", meaning: "ç‚’(èœ)"},
        {kanji: "ç‚Šã", kana: "ãŸã", meaning: "ç…®(é£¯)"},
        {kanji: "ç…®ã‚‹", kana: "ã«ã‚‹", meaning: "ç…®/ç‡‰"},
        {kanji: "ç…®ãˆã‚‹", kana: "ã«ãˆã‚‹", meaning: "ç…®ç†Ÿ"},
        {kanji: "å‡ºæ¥ä¸ŠãŒã‚‹", kana: "ã§ãã‚ãŒã‚‹", meaning: "å®Œæˆ/åšå¥½"},
        {kanji: "ä»•ä¸ŠãŒã‚‹", kana: "ã—ã‚ãŒã‚‹", meaning: "åšå®Œ/å®Œæˆ"},
        {kanji: "è£è¿”ã™", kana: "ã†ã‚‰ãŒãˆã™", meaning: "ç¿»é¢"},
        {kanji: "ç•³ã‚€", kana: "ãŸãŸã‚€", meaning: "æ‘ºç–Š"},
        {kanji: "ç‚Šäº‹", kana: "ã™ã„ã˜", meaning: "çƒ¹é£ªäº‹å‹™"},
        {kanji: "çŒ®ç«‹", kana: "ã“ã‚“ã ã¦", meaning: "èœå–®/èœè‰²"},
        {kanji: "å€‰åº«", kana: "ãã†ã“", meaning: "å€‰åº«"},
        {kanji: "é»´", kana: "ã‹ã³", meaning: "é»´èŒ"},
        {kanji: "è…ã‚‹", kana: "ãã•ã‚‹", meaning: "è…çˆ›"},
        {kanji: "æƒã", kana: "ã¯ã", meaning: "æƒåœ°"},
        {kanji: "æ‹­ã", kana: "ãµã", meaning: "æ“¦æ‹­"},
        {kanji: "çµã‚‹", kana: "ã—ã¼ã‚‹", meaning: "æ“°ä¹¾"},

        // èº«é«”/å¥åº·/ç‹€æ…‹
        {kanji: "åã", kana: "ã¯ã", meaning: "å˜”å"},
        {kanji: "é½§ã‚‹", kana: "ã‹ã˜ã‚‹", meaning: "å’¬/å•ƒ"},
        {kanji: "é…”ã†", kana: "ã‚ˆã†", meaning: "å–é†‰/æšˆè»Š"},
        {kanji: "é…”ã£æ‰•ã„", kana: "ã‚ˆã£ã±ã‚‰ã„", meaning: "é†‰æ¼¢"},
        {kanji: "ç›®çœ©", kana: "ã‚ã¾ã„", meaning: "æšˆçœ©/é ­æšˆ"},
        {kanji: "å¥¢ã‚‹", kana: "ãŠã”ã‚‹", meaning: "è«‹å®¢"},
        {kanji: "æ•¬æ„", kana: "ã‘ã„ã„", meaning: "æ•¬æ„"},
        {kanji: "æ‘˜ã‚€", kana: "ã¤ã¾ã‚€", meaning: "æ/å¤¾/æ‘˜"},
        {kanji: "èƒ¡æ¤’", kana: "ã“ã—ã‚‡ã†", meaning: "èƒ¡æ¤’"},
        {kanji: "é…¢", kana: "ã™", meaning: "é†‹"},
        {kanji: "å¡©è¾›ã„", kana: "ã—ãŠã‹ã‚‰ã„", meaning: "é¹¹çš„"},
        {kanji: "é…¸ã£ã±ã„", kana: "ã™ã£ã±ã„", meaning: "é…¸çš„"},
        {kanji: "ä½™ç¨‹", kana: "ã‚ˆã»ã©", meaning: "ç›¸ç•¶/å¾ˆå¤§ç¨‹åº¦"},
        {kanji: "é »ã‚Šã«", kana: "ã—ãã‚Šã«", meaning: "é »ç¹åœ°/å±¢æ¬¡"},
        {kanji: "å¯§ã‚", kana: "ã‚€ã—ã‚", meaning: "å¯§å¯/å€’ä¸å¦‚"},
        {kanji: "è¶³é¦–", kana: "ã‚ã—ãã³", meaning: "è…³è¸"},
        {kanji: "æ»ã‚‹", kana: "ã²ã­ã‚‹", meaning: "æ‰­è½‰/è½‰å‹•"},
        {kanji: "è¡€æ¶²", kana: "ã‘ã¤ãˆã", meaning: "è¡€æ¶²"},
        {kanji: "æ±šæŸ“", kana: "ãŠã›ã‚“", meaning: "æ±™æŸ“"},
        {kanji: "å†…ç§‘", kana: "ãªã„ã‹", meaning: "å…§ç§‘"},
        {kanji: "å¤–ç§‘", kana: "ã’ã‹", meaning: "å¤–ç§‘"},
        {kanji: "å±ˆã‚€", kana: "ã‹ãŒã‚€", meaning: "å½è…°/è¹²ä¸‹"},
        {kanji: "æ¶ˆæ¯’", kana: "ã—ã‚‡ã†ã©ã", meaning: "æ¶ˆæ¯’"},
        {kanji: "é’ç™½ã„", kana: "ã‚ãŠã˜ã‚ã„", meaning: "è’¼ç™½çš„"},
        {kanji: "è…°æ›ã‘ã‚‹", kana: "ã“ã—ã‹ã‘ã‚‹", meaning: "åä¸‹"},
        {kanji: "è¶³è·¡", kana: "ã‚ã—ã‚ã¨", meaning: "è¶³è·¡"},
        {kanji: "ç—‡çŠ¶", kana: "ã—ã‚‡ã†ã˜ã‚‡ã†", meaning: "ç—‡ç‹€"},
        {kanji: "å´©ã™", kana: "ããšã™", meaning: "å¼„å£/æå£(èº«é«”)"},
        {kanji: "ç½¹ã‚‹", kana: "ã‹ã‹ã‚‹", meaning: "ç½¹æ‚£/æ„ŸæŸ“"},
        {kanji: "ä¼æŸ“", kana: "ã§ã‚“ã›ã‚“", meaning: "å‚³æŸ“"},
        {kanji: "éª¨æŠ˜", kana: "ã“ã£ã›ã¤", meaning: "éª¨æŠ˜"},
        {kanji: "ç™½é«ª", kana: "ã—ã‚‰ãŒ", meaning: "ç™½é ­é«®"},
        {kanji: "æŠœã‘ã‚‹", kana: "ã¬ã‘ã‚‹", meaning: "è„«è½/æ‰è½"},
        {kanji: "åŒ…å¸¯", kana: "ã»ã†ãŸã„", meaning: "ç¹ƒå¸¶"},
        {kanji: "åŠ¹ã", kana: "ãã", meaning: "æœ‰æ•ˆ"},
        {kanji: "éœ‡ãˆã‚‹", kana: "ãµã‚‹ãˆã‚‹", meaning: "ç™¼æŠ–"},
        {kanji: "è‹¦ç—›", kana: "ãã¤ã†", meaning: "ç—›è‹¦"},
        {kanji: "è–¬å±€", kana: "ã‚„ã£ãã‚‡ã", meaning: "è—¥å±€"},
        {kanji: "æ‚£è€…", kana: "ã‹ã‚“ã˜ã‚ƒ", meaning: "æ‚£è€…"},
        {kanji: "è¨ºã‚‹", kana: "ã¿ã‚‹", meaning: "è¨ºå¯Ÿ"},
        {kanji: "è¨ºå¯Ÿ", kana: "ã—ã‚“ã•ã¤", meaning: "è¨ºå¯Ÿ"},
        {kanji: "è¨ºæ–­", kana: "ã—ã‚“ã ã‚“", meaning: "è¨ºæ–·"},
        {kanji: "é€™ã†", kana: "ã¯ã†", meaning: "çˆ¬è¡Œ"},
        {kanji: "å‡­ã‚Œã‚‹", kana: "ã‚‚ãŸã‚Œã‚‹", meaning: "é è‘—/èƒƒç©é£Ÿ"},
        {kanji: "ä½™åˆ†", kana: "ã‚ˆã¶ã‚“", meaning: "å¤šé¤˜çš„"},
        {kanji: "äºˆé˜²", kana: "ã‚ˆã¼ã†", meaning: "é é˜²"},
        {kanji: "é©åº¦", kana: "ã¦ãã©", meaning: "é©åº¦"},
        {kanji: "å¾¹å¤œ", kana: "ã¦ã¤ã‚„", meaning: "ç†¬å¤œ"},
        {kanji: "ä¸è¶³", kana: "ãµãã", meaning: "ä¸è¶³"},
        {kanji: "ç¡çœ ", kana: "ã™ã„ã¿ã‚“", meaning: "ç¡çœ "},
        {kanji: "åš”", kana: "ãã—ã‚ƒã¿", meaning: "æ‰“å™´åš"},
        {kanji: "åƒé€†", kana: "ã—ã‚ƒã£ãã‚Š", meaning: "æ‰“å—"},
        {kanji: "æ¬ ä¼¸", kana: "ã‚ãã³", meaning: "å“ˆæ¬ "},
        {kanji: "å¯¿å‘½", kana: "ã˜ã‚…ã¿ã‚‡ã†", meaning: "å£½å‘½"},
        {kanji: "é•·ç”Ÿã", kana: "ãªãŒã„ã", meaning: "é•·å£½"},
        {kanji: "è‚Œ", kana: "ã¯ã ", meaning: "è‚Œè†š"},
        {kanji: "è’ã‚Œã‚‹", kana: "ã‚ã‚Œã‚‹", meaning: "ç²—ç³™/è’è•ª"},
        {kanji: "å‰ƒåˆ€", kana: "ã‹ã¿ãã‚Š", meaning: "å‰ƒåˆ€"},
        {kanji: "é«­", kana: "ã²ã’", meaning: "é¬å­"},
        {kanji: "å‰ƒã‚‹", kana: "ãã‚‹", meaning: "å‰ƒ/åˆ®"},
        {kanji: "æ«›", kana: "ãã—", meaning: "æ¢³å­"},
        {kanji: "æ¢³ã‹ã™", kana: "ã¨ã‹ã™", meaning: "æ¢³ç†(é ­é«®)"},

        // æƒ…ç·’/æ…‹åº¦/äººéš›
        {kanji: "æ€’é³´ã‚‹", kana: "ã©ãªã‚‹", meaning: "æ€’å¼"},
        {kanji: "å™‚", kana: "ã†ã‚ã•", meaning: "è¬ è¨€"},
        {kanji: "åºƒã‚ã‚‹", kana: "ã²ã‚ã‚ã‚‹", meaning: "å‚³æ’­/æ¨å»£"},
        {kanji: "ç¨ã‚€", kana: "ã«ã‚‰ã‚€", meaning: "çª/æ³¨è¦–"},
        {kanji: "ä¸å¹³", kana: "ãµã¸ã„", meaning: "ä¸å¹³/æŠ±æ€¨"},
        {kanji: "æ†ã‚‰ã—ã„", kana: "ã«ãã‚‰ã—ã„", meaning: "å¯æ†çš„/è¨å­çš„"},
        {kanji: "æ†ã‚€", kana: "ã«ãã‚€", meaning: "æ†æ¨"},
        {kanji: "æ¨ã‚€", kana: "ã†ã‚‰ã‚€", meaning: "æ€¨æ¨"},
        {kanji: "æ†§ã‚Œã‚‹", kana: "ã‚ã“ãŒã‚Œã‚‹", meaning: "æ†§æ†¬"},
        {kanji: "å¦¨ã’ã‚‹", kana: "ã•ã¾ãŸã’ã‚‹", meaning: "å¦¨ç¤™"},
        {kanji: "é˜²ã", kana: "ãµã›ã", meaning: "é˜²ç¦¦/é˜²æ­¢"},
        {kanji: "å“€ã‚Œ", kana: "ã‚ã‚ã‚Œ", meaning: "æ‚²å“€/å¯æ†"},
        {kanji: "ç”Ÿæ†", kana: "ã‚ã„ã«ã", meaning: "ä¸æ¹Šå·§"},
        {kanji: "ç›¸æ£’", kana: "ã‚ã„ã¼ã†", meaning: "å¤¥ä¼´/æ­æª”"},
        {kanji: "æ´¾æ‰‹", kana: "ã¯ã§", meaning: "èŠ±ä¿/è¯éº—"},
        {kanji: "åœ°å‘³", kana: "ã˜ã¿", meaning: "æ¨¸ç´ "},
        {kanji: "å‘æ€¯", kana: "ã²ãã‚‡ã†", meaning: "å‘é„™/æ€¯æ‡¦"},
        {kanji: "å¨å¼µã‚‹", kana: "ã„ã°ã‚‹", meaning: "æ“ºæ¶å­/å‚²æ…¢"},
        {kanji: "ä¿ã¤", kana: "ãŸã‚‚ã¤", meaning: "ä¿æŒ"},
        {kanji: "å‹‡ã¾ã—ã„", kana: "ã„ã•ã¾ã—ã„", meaning: "å‹‡æ•¢/é›„å£¯"},
        {kanji: "å¼·æ°—", kana: "ã¤ã‚ˆã", meaning: "å¼·å‹¢/å¥½å‹"},
        {kanji: "å¼±æ°—", kana: "ã‚ˆã‚ã", meaning: "è»Ÿå¼±/æ€¯å¼±"},
        {kanji: "å¼·å¼•", kana: "ã”ã†ã„ã‚“", meaning: "å¼·è¡Œ/ç¡¬ä¾†"},
        {kanji: "æˆ‘å„˜", kana: "ã‚ãŒã¾ã¾", meaning: "ä»»æ€§"},
        {kanji: "é ¼ã‚Šã«ãªã‚‹", kana: "ãŸã‚ˆã‚Šã«ãªã‚‹", meaning: "å¯é "},
        {kanji: "æ´’è½", kana: "ã—ã‚ƒã‚Œ", meaning: "ç©ç¬‘/é›™é—œèª"},
        {kanji: "å¤§äººã—ã„", kana: "ãŠã¨ãªã—ã„", meaning: "æ–‡éœ/ä¹–å·§"},
        {kanji: "å–§ã—ã„", kana: "ã‚„ã‹ã¾ã—ã„", meaning: "åµé¬§/å›‰å”†"},
        {kanji: "æ…é‡", kana: "ã—ã‚“ã¡ã‚‡ã†", meaning: "æ…é‡"},
        {kanji: "ç²—å¿½", kana: "ããã£ã‹ã—ã„", meaning: "å†’å¤±/è¼•ç‡"},
        {kanji: "ä¸å™¨ç”¨", kana: "ã¶ãã‚ˆã†", meaning: "ç¬¨æ‹™"},
        {kanji: "è¦é ˜ãŒã„ã„", kana: "ã‚ˆã†ã‚Šã‚‡ã†ãŒã„ã„", meaning: "å¾ˆæœƒæŠ“è¦é ˜/éˆå·§"},
        {kanji: "è¬™è™š", kana: "ã‘ã‚“ãã‚‡", meaning: "è¬™è™›"},
        {kanji: "ç”Ÿæ„æ°—", kana: "ãªã¾ã„ã", meaning: "è‡ªå¤§/ç‹‚å¦„"},
        {kanji: "é‹­ã„", kana: "ã™ã‚‹ã©ã„", meaning: "æ•éŠ³/é‹’åˆ©"},
        {kanji: "éˆã„", kana: "ã«ã¶ã„", meaning: "é²éˆ"},
        {kanji: "ç©ã‚„ã‹", kana: "ãŠã ã‚„ã‹", meaning: "å¹³ç©©/æº«å’Œ"},
        {kanji: "é•·æ‰€", kana: "ã¡ã‚‡ã†ã—ã‚‡", meaning: "å„ªé»"},
        {kanji: "çŸ­æ‰€", kana: "ãŸã‚“ã—ã‚‡", meaning: "ç¼ºé»"},
        {kanji: "åšã‹ã¾ã—ã„", kana: "ã‚ã¤ã‹ã¾ã—ã„", meaning: "åšè‡‰çš®"},
        {kanji: "å›³ã€…ã—ã„", kana: "ãšã†ãšã†ã—ã„", meaning: "ç„¡æ¥/åšè‡‰çš®"},
        {kanji: "åå—‡", kana: "ã‘ã¡", meaning: "å°æ°£"},
        {kanji: "å¹³æ°—", kana: "ã¸ã„ã", meaning: "ä¸åœ¨ä¹/æ²’äº‹"},
        {kanji: "è£åˆ‡ã‚‹", kana: "ã†ã‚‰ãã‚‹", meaning: "èƒŒå›"},
        {kanji: "é£½ãã‚‹", kana: "ã‚ãã‚‹", meaning: "è†©"},
        {kanji: "æ…Œã¦ã‚‹", kana: "ã‚ã‚ã¦ã‚‹", meaning: "æ…Œå¼µ"},
        {kanji: "å‘‘æ°—", kana: "ã®ã‚“ã", meaning: "æ‚ é–’/æ¼«ä¸ç¶“å¿ƒ"},
        {kanji: "ç‡ç›´", kana: "ãã£ã¡ã‚‡ã", meaning: "ç›´ç‡"},
        {kanji: "ç„¦ã‚‹", kana: "ã‚ã›ã‚‹", meaning: "ç„¦æ€¥"},
        {kanji: "æ©Ÿå«Œ", kana: "ãã’ã‚“", meaning: "å¿ƒæƒ…"},
        {kanji: "æ¸…æ½”", kana: "ã›ã„ã‘ã¤", meaning: "æ¸…æ½”"},
        {kanji: "ä¸æ½”", kana: "ãµã‘ã¤", meaning: "ä¸æ½”"},
        {kanji: "è¦‹æ›ã‘", kana: "ã¿ã‹ã‘", meaning: "å¤–è¡¨"},
        {kanji: "æ…‹ã¨", kana: "ã‚ã–ã¨", meaning: "æ•…æ„"},
        {kanji: "ç›¸å¤‰ã‚ã‚‰ãš", kana: "ã‚ã„ã‹ã‚ã‚‰ãš", meaning: "ä¾èˆŠ/ç…§èˆŠ"},
        {kanji: "ç‹¡ã„", kana: "ãšã‚‹ã„", meaning: "ç‹¡çŒ¾"},
        {kanji: "æ‚„ã£ãã‚Š", kana: "ã“ã£ãã‚Š", meaning: "æ‚„æ‚„åœ°"},
        {kanji: "ç–‘ã†", kana: "ã†ãŸãŒã†", meaning: "æ‡·ç–‘"},
        {kanji: "æ•¬ã†", kana: "ã†ã‚„ã¾ã†", meaning: "å°Šæ•¬"},
        {kanji: "ç¾¨ã‚€", kana: "ã†ã‚‰ã‚„ã‚€", meaning: "ç¾¨æ…•(å‹•è©)"},
        {kanji: "æ‚©ã‚€", kana: "ãªã‚„ã‚€", meaning: "ç…©æƒ±"},
        {kanji: "å¤±æœ›", kana: "ã—ã¤ã¼ã†", meaning: "å¤±æœ›"},
        {kanji: "ç¾¨ã¾ã—ã„", kana: "ã†ã‚‰ã‚„ã¾ã—ã„", meaning: "ç¾¨æ…•(å½¢å®¹è©)"},
        {kanji: "æ°—ã®æ¯’", kana: "ãã®ã©ã", meaning: "å¯æ†/éºæ†¾"},
        {kanji: "è¬ã‚‹", kana: "ã‚ã‚„ã¾ã‚‹", meaning: "é“æ­‰"},
        {kanji: "æ…°ã‚ã‚‹", kana: "ãªãã•ã‚ã‚‹", meaning: "å®‰æ…°"},
        {kanji: "ç½µã‚‹", kana: "ã®ã®ã—ã‚‹", meaning: "è¬¾ç½µ"},
        {kanji: "è²¶ã™", kana: "ã‘ãªã™", meaning: "è²¶ä½"},
        {kanji: "é¿ã‘ã‚‹", kana: "ã•ã‘ã‚‹", meaning: "é¿é–‹"},
        {kanji: "é€ƒã’ã‚‹", kana: "ã«ã’ã‚‹", meaning: "é€ƒè·‘"},
        {kanji: "å¿ å‘Š", kana: "ã¡ã‚…ã†ã“ã", meaning: "å¿ å‘Š"},
        {kanji: "åŠ©è¨€", kana: "ã˜ã‚‡ã’ã‚“", meaning: "å»ºè­°"},
        {kanji: "è¨€ã„ã¤ã‘ã‚‹", kana: "ã„ã„ã¤ã‘ã‚‹", meaning: "å©å’/å‘Šç‹€"},
        {kanji: "è‡ªæ…¢", kana: "ã˜ã¾ã‚“", meaning: "è‡ªèª‡"},
        {kanji: "éš ã™", kana: "ã‹ãã™", meaning: "éš±è—"},
        {kanji: "ç§˜å¯†", kana: "ã²ã¿ã¤", meaning: "ç§˜å¯†"},
        {kanji: "èª¤è§£", kana: "ã”ã‹ã„", meaning: "èª¤æœƒ"},
        {kanji: "ä»²ç›´ã‚Š", kana: "ãªã‹ãªãŠã‚Š", meaning: "å’Œå¥½"},
        {kanji: "ä½œæ³•", kana: "ã•ã»ã†", meaning: "ç¦®å„€"},
        {kanji: "è¦‹ã£ã¨ã‚‚ãªã„", kana: "ã¿ã£ã¨ã‚‚ãªã„", meaning: "é›£çœ‹/ä¸Ÿè‡‰"},
        {kanji: "å¤±æ‹", kana: "ã—ã¤ã‚Œã‚“", meaning: "å¤±æˆ€"},
        {kanji: "é“å¾³", kana: "ã©ã†ã¨ã", meaning: "é“å¾·"},

        // è‡ªç„¶/åœ°é»/å…¶ä»–
        {kanji: "æ¹–", kana: "ã¿ãšã†ã¿", meaning: "æ¹–"},
        {kanji: "ç ‚", kana: "ã™ãª", meaning: "æ²™å­"},
        {kanji: "æ³¥", kana: "ã©ã‚", meaning: "æ³¥å·´"},
        {kanji: "ç·©ã‚„ã‹", kana: "ãªã ã‚‰ã‹", meaning: "å¹³ç·©/å’Œç·©"},
        {kanji: "é™ºã—ã„", kana: "ã‘ã‚ã—ã„", meaning: "éšªå³»"},
        {kanji: "æ²ˆã‚€", kana: "ã—ãšã‚€", meaning: "ä¸‹æ²‰/æ—¥è½"},
        {kanji: "ç©é›ª", kana: "ã›ãã›ã¤", meaning: "ç©é›ª"},
        {kanji: "å¸«èµ°", kana: "ã—ã‚ã™", meaning: "12æœˆ"},
        {kanji: "æ»", kana: "ãŸã", meaning: "ç€‘å¸ƒ"},
        {kanji: "å¤œæ˜ã‘", kana: "ã‚ˆã‚ã‘", meaning: "é»æ˜"},
        {kanji: "æ—¥å·®ã—", kana: "ã²ã–ã—", meaning: "é™½å…‰"},
        {kanji: "è™¹", kana: "ã«ã˜", meaning: "å½©è™¹"},
        {kanji: "è’ã‚Œã‚‹", kana: "ã‚ã‚Œã‚‹", meaning: "å¤©æ°£è®Šç³Ÿ"},
        {kanji: "æ˜¨å¤œ", kana: "ã•ãã‚„", meaning: "æ˜¨æ™š"},

        // å·¥ä½œ/å­¸æ¥­/ç¤¾æœƒ
        {kanji: "å¼•ãå—ã‘ã‚‹", kana: "ã²ãã†ã‘ã‚‹", meaning: "æ‰¿æ“”/æ¥å—"},
        {kanji: "é›‡ã†", kana: "ã‚„ã¨ã†", meaning: "é›‡ç”¨"},
        {kanji: "é›‡ã‚ã‚Œã‚‹", kana: "ã‚„ã¨ã‚ã‚Œã‚‹", meaning: "è¢«é›‡ç”¨"},
        {kanji: "å„²ã‘ã‚‹", kana: "ã‚‚ã†ã‘ã‚‹", meaning: "è³ºéŒ¢/è¨­ç«‹"},
        {kanji: "å„²ã‹ã‚‹", kana: "ã‚‚ã†ã‹ã‚‹", meaning: "è³ºéŒ¢(è‡ª)"},
        {kanji: "å½“ã¦ã¯ã¾ã‚‹", kana: "ã‚ã¦ã¯ã¾ã‚‹", meaning: "é©ç”¨/ç¬¦åˆ"},
        {kanji: "å¼µã‚Šåˆ‡ã‚‹", kana: "ã¯ã‚Šãã‚‹", meaning: "å……æ»¿å¹¹å‹"},
        {kanji: "è¿½ã„ã‹ã‘ã‚‹", kana: "ãŠã„ã‹ã‘ã‚‹", meaning: "è¿½è¶•"},
        {kanji: "æŒ‡ç¤º", kana: "ã—ã˜", meaning: "æŒ‡ç¤º"},
        {kanji: "å°±ä»»", kana: "ã—ã‚…ã†ã«ã‚“", meaning: "å°±ä»»"},
        {kanji: "å‹¤ã‚ã‚‹", kana: "ã¤ã¨ã‚ã‚‹", meaning: "å·¥ä½œ/ä»»è·"},
        {kanji: "æå®³", kana: "ãã‚“ãŒã„", meaning: "æå®³"},
        {kanji: "çµ„ç¹”", kana: "ãã—ã", meaning: "çµ„ç¹”"},
        {kanji: "ä¸‡ãŒä¸€", kana: "ã¾ã‚“ãŒã„ã¡", meaning: "è¬ä¸€"},
        {kanji: "ç«¶æŠ€", kana: "ãã‚‡ã†ã", meaning: "ç«¶æŠ€/æ¯”è³½"},
        {kanji: "å‡ºå ´", kana: "ã—ã‚…ã¤ã˜ã‚‡ã†", meaning: "å‡ºå ´(æ¯”è³½)"},
        {kanji: "å½“åˆ†", kana: "ã¨ã†ã¶ã‚“", meaning: "æš«æ™‚/ç›®å‰"},
        {kanji: "æœå®Ÿ", kana: "ã‹ã˜ã¤", meaning: "æœå¯¦"},
        {kanji: "å®Ÿã‚‹", kana: "ã¿ã®ã‚‹", meaning: "çµæœå¯¦/æˆç†Ÿ"},
        {kanji: "é¢å€’", kana: "ã‚ã‚“ã©ã†", meaning: "éº»ç…©/ç…§é¡§"},
        {kanji: "å¹¼ç¨šåœ’", kana: "ã‚ˆã†ã¡ãˆã‚“", meaning: "å¹¼ç¨šåœ’"},
        {kanji: "å¹¼å…", kana: "ã‚ˆã†ã˜", meaning: "å¹¼å…’"},
        {kanji: "ç­†è¨˜è©¦é¨“", kana: "ã²ã£ãã—ã‘ã‚“", meaning: "ç­†è©¦"},
        {kanji: "ç­”æ¡ˆ", kana: "ã¨ã†ã‚ã‚“", meaning: "ç­”æ¡ˆå·"},
        {kanji: "å“²å­¦", kana: "ã¦ã¤ãŒã", meaning: "å“²å­¸"},
        {kanji: "æ¼”ç¿’", kana: "ãˆã‚“ã—ã‚…ã†", meaning: "æ¼”ç¿’/ç ”è¨"},
        {kanji: "æ•™æˆ", kana: "ãã‚‡ã†ã˜ã‚…", meaning: "æ•™æˆ"},
        {kanji: "å—ã‘æŒã¤", kana: "ã†ã‘ã‚‚ã¤", meaning: "æ“”ä»»/è² è²¬"},
        {kanji: "æ‹…å½“", kana: "ãŸã‚“ã¨ã†", meaning: "æ“”ç•¶/è² è²¬"},
        {kanji: "å›½ç«‹", kana: "ã“ãã‚Šã¤", meaning: "åœ‹ç«‹"},
        {kanji: "ç§ç«‹", kana: "ã—ã‚Šã¤", meaning: "ç§ç«‹"},
        {kanji: "å°‚æ”»", kana: "ã›ã‚“ã“ã†", meaning: "å°ˆæ”»"},
        {kanji: "å‚è€ƒæ–‡çŒ®", kana: "ã•ã‚“ã“ã†ã¶ã‚“ã‘ã‚“", meaning: "åƒè€ƒæ–‡ç»"},
        {kanji: "ä»Šä¸€", kana: "ã„ã¾ã„ã¡", meaning: "å·®ä¸€é»/æ™®æ™®"},
        {kanji: "æŠ˜è§’", kana: "ã›ã£ã‹ã", meaning: "ç‰¹åœ°/é›£å¾—"},
        {kanji: "æˆ–ã„ã¯", kana: "ã‚ã‚‹ã„ã¯", meaning: "æˆ–è€…"},
        {kanji: "ãã‚‚ãã‚‚", kana: "ãã‚‚ãã‚‚", meaning: "åŸæœ¬/æœ€åˆ"},
        {kanji: "å‹Ÿé›†", kana: "ã¼ã—ã‚…ã†", meaning: "å‹Ÿé›†"},
        {kanji: "å¿œå‹Ÿ", kana: "ãŠã†ã¼", meaning: "æ‡‰å¾µ"},
        {kanji: "è¦‹è¾¼ã¿", kana: "ã¿ã“ã¿", meaning: "é ä¼°/å¸Œæœ›"},
        {kanji: "æ‰‹å½“", kana: "ã¦ã‚ã¦", meaning: "æ²»ç™‚/æ´¥è²¼"},
        {kanji: "æ´»èº", kana: "ã‹ã¤ã‚„ã", meaning: "æ´»èº"},
        {kanji: "å¾“ã†", kana: "ã—ãŸãŒã†", meaning: "æœå¾/è·Ÿéš¨"},
        {kanji: "é¸æ‰‹", kana: "ã›ã‚“ã—ã‚…", meaning: "é¸æ‰‹"},
        {kanji: "æ”»ã‚ã‚‹", kana: "ã›ã‚ã‚‹", meaning: "æ”»æ“Š"},
        {kanji: "å‹è² ", kana: "ã—ã‚‡ã†ã¶", meaning: "å‹è² "},
        {kanji: "å‹æ•—", kana: "ã—ã‚‡ã†ã¯ã„", meaning: "å‹æ•—"},
        {kanji: "æ•—ã‚Œã‚‹", kana: "ã‚„ã¶ã‚Œã‚‹", meaning: "æ•—åŒ—/è¼¸"},
        {kanji: "å¼•ãåˆ†ã‘", kana: "ã²ãã‚ã‘", meaning: "å¹³æ‰‹"},
        {kanji: "èª­æ›¸", kana: "ã©ãã—ã‚‡", meaning: "è®€æ›¸"},
        {kanji: "è‘—è€…", kana: "ã¡ã‚‡ã—ã‚ƒ", meaning: "ä½œè€…"},
        {kanji: "æ›¸ç±", kana: "ã—ã‚‡ã›ã", meaning: "æ›¸ç±"},
        {kanji: "ç›®æ¬¡", kana: "ã‚‚ãã˜", meaning: "ç›®éŒ„"},
        {kanji: "ç´¢å¼•", kana: "ã•ãã„ã‚“", meaning: "ç´¢å¼•"},
        {kanji: "è©•è«–", kana: "ã²ã‚‡ã†ã‚ã‚“", meaning: "è©•è«–"},
        {kanji: "åŸ·ç­†", kana: "ã—ã£ã´ã¤", meaning: "åŸ·ç­†"},
        {kanji: "å¤å…¸", kana: "ã“ã¦ã‚“", meaning: "å¤å…¸"},
        {kanji: "è¨³ã™", kana: "ã‚„ãã™", meaning: "ç¿»è­¯"},
        {kanji: "å°èª¬", kana: "ã—ã‚‡ã†ã›ã¤", meaning: "å°èªª"},
        {kanji: "å‚‘ä½œ", kana: "ã‘ã£ã•ã", meaning: "å‚‘ä½œ"},
        {kanji: "åå ´é¢", kana: "ã‚ã„ã°ã‚ã‚“", meaning: "åå ´é¢"},
        {kanji: "éšç­†", kana: "ãšã„ã²ã¤", meaning: "éš¨ç­†"},
        {kanji: "è¦‹ã¤ã‹ã‚‹", kana: "ã¿ã¤ã‹ã‚‹", meaning: "è¢«ç™¼ç¾/æ‰¾åˆ°"},
        {kanji: "ç²—ç­‹", kana: "ã‚ã‚‰ã™ã˜", meaning: "æ¦‚è¦/å¤§ç¶±"},
        {kanji: "æ¼”åŠ‡", kana: "ãˆã‚“ã’ã", meaning: "æˆ²åŠ‡"},
        {kanji: "åŠ‡å ´", kana: "ã’ãã˜ã‚‡ã†", meaning: "åŠ‡å ´"},
        {kanji: "èŠå±…", kana: "ã—ã°ã„", meaning: "æˆ²åŠ‡/æ¼”æŠ€"},
        {kanji: "æ¼”æŠ€", kana: "ãˆã‚“ã", meaning: "æ¼”æŠ€"},
        {kanji: "ä¸»å½¹", kana: "ã—ã‚…ã‚„ã", meaning: "ä¸»è§’"},
        {kanji: "è„‡å½¹", kana: "ã‚ãã‚„ã", meaning: "é…è§’"},
        {kanji: "èˆå°", kana: "ã¶ãŸã„", meaning: "èˆå°"},
        {kanji: "å¹•", kana: "ã¾ã", meaning: "å¹•"},
        {kanji: "å°è©", kana: "ã›ã‚Šãµ", meaning: "å°è©"},
        {kanji: "æ¼”å¥", kana: "ãˆã‚“ãã†", meaning: "æ¼”å¥"},
        {kanji: "è£ç¸«", kana: "ã•ã„ã»ã†", meaning: "è£ç¸«"},
        {kanji: "å·¥èŠ¸", kana: "ã“ã†ã’ã„", meaning: "å·¥è—"},
        {kanji: "ç¶¿", kana: "ã‚ãŸ", meaning: "æ£‰èŠ±"},
        {kanji: "è©°ã‚ã‚‹", kana: "ã¤ã‚ã‚‹", meaning: "å¡æ»¿/ç¸®çŸ­"},
        {kanji: "å‰Šã‚‹", kana: "ã‘ãšã‚‹", meaning: "å‰Šæ¸›/å‰Š"},
        {kanji: "å½«ã‚‹", kana: "ã»ã‚‹", meaning: "é›•åˆ»"},
        {kanji: "åƒ…ã‹", kana: "ã‚ãšã‹", meaning: "åƒ…åƒ…/å°‘è¨±"},
        {kanji: "å®Ÿã«", kana: "ã˜ã¤ã«", meaning: "å¯¦åœ¨æ˜¯/çš„ç¢º"},
        {kanji: "å®Ÿã¯", kana: "ã˜ã¤ã¯", meaning: "å…¶å¯¦/äº‹å¯¦ä¸Š"},
        {kanji: "æ­£ã«", kana: "ã¾ã•ã«", meaning: "æ­£æ˜¯/çš„ç¢º"},
        {kanji: "ä¸€å¿œ", kana: "ã„ã¡ãŠã†", meaning: "å§‘ä¸”/å¤§è‡´"},
        {kanji: "å¿½ã¡", kana: "ãŸã¡ã¾ã¡", meaning: "è½‰ç¬é–“"},
        {kanji: "ä»Šã«", kana: "ã„ã¾ã«", meaning: "å³å°‡/ç¸½æœ‰ä¸€å¤©"}
    ];

    let quizQueue = [];
    let completedCount = 0;
    let wrongCount = 0;
    const TOTAL_QUESTIONS = 20;

    // ç”¢ç”Ÿè®€éŸ³å¹²æ“¾é … (é•·éŸ³ã€ä¿ƒéŸ³ã€æ¿éŸ³è®ŠåŒ–)
    function generateReadingDistractors(correctKana) {
        let distractors = new Set();
        
        // å˜—è©¦ç”Ÿæˆè®Šé«”
        while (distractors.size < 3) {
            let fake = correctKana;
            const method = Math.floor(Math.random() * 5);

            if (method === 0) { // æ¿éŸ³/åŠæ¿éŸ³æ··æ·† (k<->g, t<->d, h<->p/b)
                fake = fake.replace(/ã‹/g, 'ãŒ').replace(/ã/g, 'ã').replace(/ã/g, 'ã').replace(/ã‘/g, 'ã’').replace(/ã“/g, 'ã”')
                           .replace(/ãŸ/g, 'ã ').replace(/ã¦/g, 'ã§').replace(/ã¨/g, 'ã©')
                           .replace(/ã—/g, 'ã˜').replace(/ã™/g, 'ãš')
                           .replace(/ã¯/g, 'ã±').replace(/ã²/g, 'ã³').replace(/ãµ/g, 'ã·')
                           .replace(/ãŒ/g, 'ã‹').replace(/ã˜/g, 'ã—').replace(/ã /g, 'ãŸ'); // åå‘æ··æ·†
            } else if (method === 1) { // é•·éŸ³æ“ä½œ
                if (fake.includes('ã†')) fake = fake.replace('ã†', ''); // ç§»é™¤é•·éŸ³
                else if (fake.match(/[ãŠã“ãã¨ã©ã®ã‚‚ã‚]/)) fake += 'ã†'; // æ·»åŠ é•·éŸ³
                else if (fake.match(/[ãˆã‘ã›ã¦ã­ã‚ã‚Œ]/)) fake += 'ã„';
            } else if (method === 2) { // ä¿ƒéŸ³æ“ä½œ
                if (fake.includes('ã£')) fake = fake.replace('ã£', 'ã¤'); // ç§»é™¤ä¿ƒéŸ³
                else if (fake.length > 2) fake = fake.slice(0, 1) + 'ã£' + fake.slice(1); // éš¨æ©Ÿæ’å…¥ä¿ƒéŸ³
            } else if (method === 3) { // æ‹—éŸ³æ··æ·† (shu <-> su)
                if (fake.includes('ã‚ƒ') || fake.includes('ã‚…') || fake.includes('ã‚‡')) {
                   fake = fake.replace(/[ã‚ƒã‚…ã‚‡]/g, ''); 
                }
            } else { // éš¨æ©Ÿæ›¿æ›å°¾éŸ³
                const endings = ['ã„', 'ã‚“', 'ã¤', 'ã†', 'ã'];
                fake = fake.slice(0, -1) + endings[Math.floor(Math.random() * endings.length)];
            }

            // å¦‚æœè®Šé«”è·Ÿæ­£ç¢ºç­”æ¡ˆä¸åŒï¼Œä¸”é•·åº¦åˆç†ï¼ŒåŠ å…¥é›†åˆ
            if (fake !== correctKana && fake.length >= 1) {
                distractors.add(fake);
            }
            
            // å®‰å…¨é–¥ï¼šéš¨æ©ŸæŠ“ä¸€å€‹åˆ¥çš„å­—çš„è®€éŸ³
            if (Math.random() > 0.7) {
                const randomWord = rawData[Math.floor(Math.random() * rawData.length)];
                if (randomWord.kana !== correctKana) distractors.add(randomWord.kana);
            }
        }
        return Array.from(distractors);
    }

    // ç”¢ç”Ÿæ„æ€å¹²æ“¾é …
    function generateMeaningDistractors(correctMeaning) {
        let distractors = new Set();
        while (distractors.size < 3) {
            const randomWord = rawData[Math.floor(Math.random() * rawData.length)];
            if (randomWord.meaning !== correctMeaning) {
                distractors.add(randomWord.meaning);
            }
        }
        return Array.from(distractors);
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startQuiz() {
        // éš¨æ©ŸæŠ½å– 20 å€‹ä¸é‡è¤‡çš„å–®å­—
        const shuffledWords = shuffle([...rawData]).slice(0, TOTAL_QUESTIONS);
        
        // åˆ†é… 10 é¡Œè®€éŸ³ï¼Œ10 é¡Œæ„æ€
        const readingQ = shuffledWords.slice(0, 10).map(word => ({
            type: 'READING',
            text: word.kanji,
            correct: word.kana,
            options: shuffle([word.kana, ...generateReadingDistractors(word.kana)]),
            raw: word
        }));

        const meaningQ = shuffledWords.slice(10, 20).map(word => ({
            type: 'MEANING',
            text: word.kanji,
            correct: word.meaning,
            options: shuffle([word.meaning, ...generateMeaningDistractors(word.meaning)]),
            raw: word
        }));

        quizQueue = shuffle([...readingQ, ...meaningQ]);
        completedCount = 0;
        wrongCount = 0;

        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        
        renderQuestion();
    }

    function renderQuestion() {
        if (quizQueue.length === 0) {
            showResult();
            return;
        }

        const q = quizQueue[0];
        
        // æ›´æ–°é€²åº¦
        const progressPercent = (completedCount / TOTAL_QUESTIONS) * 100;
        document.getElementById('progress-text').innerText = `å·²å®Œæˆ: ${completedCount} / ${TOTAL_QUESTIONS}`;
        document.getElementById('queue-count').innerText = `å‰©é¤˜é¡Œç›®: ${quizQueue.length}`;
        document.getElementById('progress-fill').style.width = `${Math.min(progressPercent, 100)}%`;

        // é¡¯ç¤ºé¡Œç›®
        document.getElementById('q-type').innerText = q.type === 'READING' ? 'é¸å‡ºæ­£ç¢ºè®€éŸ³' : 'é¸å‡ºæ­£ç¢ºæ„æ€';
        document.getElementById('q-word').innerText = q.text;
        document.getElementById('feedback-msg').innerText = '';

        const container = document.getElementById('options-container');
        container.innerHTML = '';

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => handleAnswer(btn, opt, q);
            container.appendChild(btn);
        });
    }

    function handleAnswer(btn, selected, question) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if (selected === question.correct) {
            // ç­”å°
            btn.classList.add('correct');
            document.getElementById('feedback-msg').style.color = 'var(--success)';
            document.getElementById('feedback-msg').innerText = 'æ­£è§£ï¼';
            
            setTimeout(() => {
                quizQueue.shift(); // ç§»é™¤è©²é¡Œ
                if (quizQueue.length < (TOTAL_QUESTIONS - completedCount)) {
                    // åªæœ‰ç•¶ä¸æ˜¯é‡è€ƒé¡Œæ™‚æ‰å¢åŠ é€²åº¦
                } else {
                    completedCount++; 
                }
                
                // é‚è¼¯ä¿®æ­£ï¼šå¦‚æœé€™é¡Œæ˜¯ä¹‹å‰ç­”éŒ¯é‡æ’çš„ï¼ŒcompletedCount ä¸åŠ ï¼Ÿ
                // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘ç”¨ (åˆå§‹ç¸½æ•¸ - å‰©é¤˜é¡Œæ•¸) ä¾†è¨ˆç®—é€²åº¦è¦–è¦º
                completedCount = TOTAL_QUESTIONS - quizQueue.length;
                if(completedCount < 0) completedCount = 0; // é˜²æ­¢å‰›é–‹å§‹éŒ¯é¡Œå°è‡´è² æ•¸

                renderQuestion();
            }, 800);
        } else {
            // ç­”éŒ¯
            btn.classList.add('wrong');
            wrongCount++;
            
            // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
            allBtns.forEach(b => {
                if (b.innerText === question.correct) b.classList.add('correct');
            });

            document.getElementById('feedback-msg').style.color = 'var(--error)';
            const hint = question.type === 'MEANING' ? ` (${question.raw.kana})` : '';
            document.getElementById('feedback-msg').innerText = `éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆï¼š${question.correct}${hint}`;

            // å°‡é¡Œç›®ç§»åˆ°éšŠåˆ—æœ€å¾Œ (é‡è€ƒ)
            const retryQ = quizQueue.shift();
            retryQ.options = shuffle(retryQ.options); // é‡æ–°æ´—ç‰Œé¸é …
            quizQueue.push(retryQ);

            setTimeout(() => {
                renderQuestion();
            }, 2500);
        }
    }

    function showResult() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-wrongs').innerText = `âŒ ç¸½éŒ¯èª¤æ¬¡æ•¸ï¼š${wrongCount} æ¬¡`;
    }
</script>

</body>
</html>
