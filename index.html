<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JLPT 考前衝刺特訓 (50/50 比例版)</title>
<style>
    :root {
        --primary: #4f46e5;
        --bg: #f3f4f6;
        --card-bg: #ffffff;
        --text: #1f2937;
        --correct: #10b981;
        --wrong: #ef4444;
    }
    body {
        font-family: "Hiragino Kaku Gothic ProN", "Meiryo", "Microsoft JhengHei", sans-serif;
        background-color: var(--bg);
        color: var(--text);
        display: flex;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
    }
    .container {
        width: 100%;
        max-width: 600px;
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    h1 { font-size: 1.5rem; margin-bottom: 0.5rem; text-align: center; color: var(--primary); }
    .subtitle { font-size: 0.9rem; color: #6b7280; margin-bottom: 2rem; text-align: center; }
    
    /* Quiz Area */
    .quiz-area { width: 100%; display: none; }
    .active { display: block; }
    
    .status-bar {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: #6b7280;
    }
    
    .question-card {
        background: #eef2ff;
        border-radius: 12px;
        padding: 2rem 1rem;
        text-align: center;
        margin-bottom: 1.5rem;
        position: relative;
    }
    
    .q-type {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
    }

    .q-word {
        font-size: 2.5rem;
        font-weight: bold;
        color: #111827;
        margin-top: 10px;
    }

    .options-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    button.opt-btn {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 10px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--text);
        min-height: 80px; /* 增加高度以容納換行 */
        display: flex;
        flex-direction: column; /* 垂直排列 */
        align-items: center;
        justify-content: center;
        line-height: 1.4; /* 增加行距 */
    }

    button.opt-btn:hover { border-color: var(--primary); background: #f5f7ff; }
    
    button.opt-btn.correct { background: var(--correct); color: white; border-color: var(--correct); }
    button.opt-btn.wrong { background: var(--wrong); color: white; border-color: var(--wrong); }
    button.opt-btn.disabled { pointer-events: none; opacity: 0.6; }

    .feedback-msg {
        text-align: center;
        height: 20px;
        margin-top: 10px;
        font-weight: bold;
    }

    /* Start & End Screen */
    .screen { text-align: center; width: 100%; }
    .btn-main {
        background: var(--primary);
        color: white;
        border: none;
        padding: 12px 32px;
        border-radius: 50px;
        font-size: 1.1rem;
        cursor: pointer;
        margin-top: 20px;
        box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.39);
    }
    .btn-main:hover { transform: translateY(-1px); }

    @media (max-width: 480px) {
        .options-grid { grid-template-columns: 1fr; }
        .container { padding: 1.5rem; }
    }
</style>
</head>
<body>

<div class="container">
    <div id="start-screen" class="screen active">
        <h1>🔥 日檢單字地獄特訓</h1>
        <p class="subtitle">本次測驗將**平均分配**兩種題型：<br>意思題 10 題，讀音題 10 題</p>
        <p>每次測驗 20 題，錯誤會自動重來</p>
        <button class="btn-main" onclick="startQuiz()">開始特訓</button>
    </div>

    <div id="quiz-screen" class="quiz-area">
        <div class="status-bar">
            <span id="progress-text">第 1 / 20 題</span>
            <span id="score-text">剩餘: 20</span>
        </div>
        
        <div class="question-card">
            <span id="q-tag" class="q-type">題型</span>
            <div id="q-text" class="q-word">題目</div>
        </div>

        <div id="options-box" class="options-grid">
            </div>
        <div id="feedback" class="feedback-msg"></div>
    </div>

    <div id="result-screen" class="screen" style="display:none;">
        <h1>🎉 辛苦了！</h1>
        <p>你完成了本輪的 20 題特訓。</p>
        <p style="font-size: 0.9rem; color: #666;">（雖然過程很痛苦，但記得越清楚）</p>
        <button class="btn-main" onclick="location.reload()">再來一輪</button>
    </div>
</div>

<script>
// ==========================================
// 你的專屬單字庫 (完整版)
// ==========================================
const rawData = [
    // === 家事與生活動作 ===
    {k:"引っ繰り返す", r:"ひっくりかえす", m:"翻過來/推翻"},
    {k:"毛糸", r:"けいと", m:"毛線"},
    {k:"編む", r:"あむ", m:"編織"},
    {k:"散らかる", r:"ちらかる", m:"(垃圾)散亂/凌亂"},
    {k:"退ける", r:"どける", m:"挪開/移開 (物品)"},
    {k:"埃", r:"ほこり", m:"灰塵"},
    {k:"箒", r:"ほうき", m:"掃把"},
    {k:"塵取り", r:"ちりとり", m:"畚箕"},
    {k:"干す", r:"ほす", m:"曬/晾"},
    {k:"乾かす", r:"かわかす", m:"弄乾/吹乾"},
    {k:"皺を伸ばす", r:"しわをのばす", m:"弄平皺褶"},
    {k:"吊るす", r:"つるす", m:"吊/掛"},
    {k:"茹でる", r:"ゆでる", m:"水煮/燙"},
    {k:"炒る", r:"いる", m:"炒/煎 (乾炒)"},
    {k:"炒める", r:"いためる", m:"炒 (有油)"},
    {k:"ご飯を炊く", r:"ごはんをたく", m:"煮飯"},
    {k:"煮る", r:"にる", m:"煮 (他動詞)"},
    {k:"煮える", r:"にえる", m:"煮熟 (自動詞)"},
    {k:"出来上がる", r:"できあがる", m:"完成/做好"},
    {k:"仕上がる", r:"しあがる", m:"完成/做完 (強調結果)"},
    {k:"出来立て", r:"できたて", m:"剛做好的 (料理)"},
    {k:"齧る", r:"かじる", m:"咬/啃"},
    {k:"酔いが覚める", r:"よいがさめる", m:"酒醒"},
    {k:"酔っ払い", r:"よっぱらい", m:"醉漢"},
    {k:"目眩がする", r:"めまいがする", m:"頭暈"},
    {k:"奢る", r:"おごる", m:"請客"},
    {k:"敬意", r:"けいい", m:"敬意"},
    {k:"抓む", r:"つまむ", m:"捏/夾 (吃點心)"},
    {k:"胡椒", r:"こしょう", m:"胡椒"},
    {k:"酢", r:"す", m:"醋"},
    {k:"塩辛い", r:"しおからい", m:"鹹的"},
    {k:"酸っぱい", r:"すっぱい", m:"酸的"},
    {k:"さっぱり", r:"さっぱり", m:"清淡的/爽快的"},
    {k:"しつこい", r:"しつこい", m:"油膩的/糾纏不休的"},
    {k:"くどい", r:"くどい", m:"囉唆的/口味過重的"},
    {k:"好き好き", r:"すきずき", m:"各有所好"},
    {k:"好き嫌い", r:"すききらい", m:"挑食/好惡"},
    {k:"不味い", r:"まずい", m:"難吃的/糟糕的"},
    {k:"余程", r:"よほど", m:"相當/很 (☆)"},
    {k:"頻りに", r:"しきりに", m:"頻繁地/屢次 (☆)"},
    {k:"寧ろ", r:"むしろ", m:"與其...不如/寧可 (☆)"},
    
    // === 情緒與態度 ===
    {k:"怒鳴る", r:"どなる", m:"怒吼/大聲斥責"},
    {k:"噂", r:"うわさ", m:"謠言"},
    {k:"広める", r:"ひろめる", m:"散播/傳播"},
    {k:"睨む", r:"にらむ", m:"瞪眼/注視"},
    {k:"不平", r:"ふへい", m:"不滿/牢騷"},
    {k:"憎らしい", r:"にくらしい", m:"可憎的/討厭的"},
    {k:"憎む", r:"にくむ", m:"憎恨"},
    {k:"恨む", r:"うらむ", m:"怨恨"},
    {k:"憧れる", r:"あこがれる", m:"憧憬/嚮往"},
    {k:"妨げる", r:"さまたげる", m:"妨礙/阻饒"},
    {k:"防ぐ", r:"ふせぐ", m:"防禦/防止"},
    {k:"哀れ", r:"あわれ", m:"悲哀/可憐"},
    {k:"生憎", r:"あいにく", m:"不湊巧"},
    {k:"相棒", r:"あいぼう", m:"夥伴/搭檔"},
    {k:"派手な", r:"はでな", m:"花俏的/華麗的"},
    {k:"卑怯な", r:"ひきょうな", m:"卑鄙的"},
    {k:"威張る", r:"いばる", m:"逞威風/傲慢"},
    {k:"保つ", r:"たもつ", m:"保持/維持 (☆)"},
    {k:"勇ましい", r:"いさましい", m:"勇猛的/勇敢的 (☆)"},
    
    // === 身體與醫療 ===
    {k:"足首", r:"あしくび", m:"腳踝"},
    {k:"捻る", r:"ひねる", m:"扭到/轉動 (開關)"},
    {k:"血液", r:"けつえき", m:"血液 (☆)"},
    {k:"汚染", r:"おせん", m:"污染"},
    {k:"内科", r:"ないか", m:"內科"},
    {k:"外科", r:"げか", m:"外科"},
    {k:"床", r:"ゆか", m:"地板"},
    {k:"蹲る", r:"しゃがむ", m:"蹲下"},
    {k:"消毒", r:"しょうどく", m:"消毒"},
    {k:"青白い", r:"あおじろい", m:"蒼白的 (臉色)"},
    {k:"腰掛ける", r:"こしかける", m:"坐 (椅子)"},
    {k:"足の跡", r:"あしのあと", m:"腳印"},
    
    // === 自然與地理 ===
    {k:"湖", r:"みずうみ", m:"湖泊"},
    {k:"砂", r:"すな", m:"沙子"},
    {k:"泥", r:"どろ", m:"泥巴"},
    {k:"緩やかな", r:"なだらかな", m:"平緩的 (坡度)"},
    {k:"険しい", r:"けわしい", m:"險峻的"},
    {k:"夕日", r:"ゆうひ", m:"夕陽"},
    {k:"沈む", r:"しずむ", m:"下沉/西沈"},
    {k:"積雪", r:"せきせつ", m:"積雪"},
    {k:"師走", r:"しわす", m:"臘月/12月"},
    {k:"滝", r:"たき", m:"瀑布"},

    // === 性格與形容 ===
    {k:"だらしない", r:"だらしない", m:"散漫的/沒規矩的"},
    {k:"ダラダラ", r:"だらだら", m:"懶散地/滴滴答答地"},
    {k:"強気な", r:"つよきな", m:"強硬的/不服輸的"},
    {k:"弱気な", r:"よわきな", m:"膽怯的"},
    {k:"強引な", r:"ごういんな", m:"強行的/硬來的"},
    {k:"我儘", r:"わがまま", m:"任性"},
    {k:"頼りになる", r:"たよりになる", m:"可靠的"},
    {k:"気が荒い", r:"きがあらい", m:"脾氣暴躁"},
    {k:"洒落", r:"しゃれ", m:"玩笑/雙關語"},

    // === 工作與社會 ===
    {k:"引き受ける", r:"ひきうける", m:"承接/承擔"},
    {k:"雇う", r:"やとう", m:"雇用"},
    {k:"雇われる", r:"やとわれる", m:"被雇用"},
    {k:"設ける", r:"もうける", m:"設立/制定"},
    {k:"儲かる", r:"もうかる", m:"賺錢 (自動詞)"},
    {k:"当て嵌まる", r:"あてはまる", m:"適用/符合"},
    {k:"張り切る", r:"はりきる", m:"幹勁十足"},
    {k:"追いかける", r:"おいかける", m:"追趕"},
    {k:"指示する", r:"しじする", m:"指示"},
    {k:"就任する", r:"しゅうにんする", m:"就任"},
    {k:"勤める", r:"つとめる", m:"任職/工作"},
    {k:"損害", r:"そんがい", m:"損害"},
    {k:"組織", r:"そしき", m:"組織"},

    // === 副詞與連接詞 ===
    {k:"万が一", r:"まんがいち", m:"萬一 (☆)"},
    {k:"或いは", r:"あるいは", m:"或者"},
    {k:"競技", r:"きょうぎ", m:"競技/比賽"},
    {k:"出場", r:"しゅつじょう", m:"出場 (比賽)"},
    {k:"当分", r:"とうぶん", m:"暫時/目前 (☆)"},
    {k:"果実", r:"かじつ", m:"果實"},
    {k:"実る", r:"みのる", m:"結果/成熟"},
    {k:"面倒", r:"めんどう", m:"麻煩/照顧"},
    {k:"吃驚", r:"うっかり", m:"不小心/發呆 (☆)"},
    {k:"可也", r:"かなり", m:"相當"},
    {k:"結構", r:"けっこう", m:"很好/相當"},
    {k:"大分", r:"だいぶ", m:"很/相當"},
    {k:"相当", r:"そうとう", m:"相當 (☆)"},

    // === 學校與學術 ===
    {k:"夜明け", r:"よあけ", m:"黎明"},
    {k:"日差し", r:"ひざし", m:"陽光照射"},
    {k:"眩しい", r:"まぶしい", m:"耀眼的"},
    {k:"幼稚園", r:"ようちえん", m:"幼稚園"},
    {k:"幼児", r:"ようじ", m:"幼兒"},
    {k:"問い", r:"とい", m:"問題/提問"},
    {k:"筆記試験", r:"ひっきしけん", m:"筆試"},
    {k:"答案", r:"とうあん", m:"答案卷"},
    {k:"哲学", r:"てつがく", m:"哲學"},
    {k:"演習", r:"えんしゅう", m:"演習/研討課(ゼミ)"},
    {k:"教授", r:"きょうじゅ", m:"教授"},
    {k:"受け持つ", r:"うけもつ", m:"擔任/負責"},
    {k:"担当", r:"たんとう", m:"擔當/負責"},
    {k:"国立", r:"こくりつ", m:"國立"},
    {k:"私立", r:"しりつ", m:"私立"},
    {k:"専攻", r:"せんこう", m:"專攻/主修"},
    {k:"参考文献", r:"さんこうぶんけん", m:"參考文獻"},

    // === 其他 ===
    {k:"今一", r:"いまいち", m:"差一點/不夠好"},
    {k:"折角", r:"せっかく", m:"特意/好不容易"},
    {k:"少なくとも", r:"せめて", m:"至少/起碼"},
    {k:"散々", r:"ばらばら", m:"支離破碎/分散"},
    {k:"元々", r:"そもそも", m:"原本/到底"},
    {k:"配る", r:"くばる", m:"分發"},
    {k:"余る", r:"あまる", m:"剩餘"},
    {k:"盛んに", r:"さかんに", m:"盛大地/頻繁地"},
    {k:"応募", r:"おうぼ", m:"應徵"},
    {k:"爽やか", r:"さわやか", m:"清爽"},
    {k:"見込み", r:"みこみ", m:"預估/希望"},
    {k:"荒れる", r:"あれる", m:"荒蕪/天氣變糟"},
    {k:"昨夜", r:"さくや", m:"昨晚"},
    {k:"焦げる", r:"こげる", m:"燒焦"},
    {k:"火傷", r:"やけど", m:"燙傷"},
    {k:"手当", r:"てあて", m:"治療/津貼"},
    {k:"居間", r:"いま", m:"客廳"},
    {k:"触れる", r:"ふれる", m:"觸摸/提及"},

    // === 親屬與人際 ===
    {k:"祖先", r:"そせん", m:"祖先"},
    {k:"子孫", r:"しそん", m:"子孫"},
    {k:"孫", r:"まご", m:"孫子"},
    {k:"世代", r:"せだい", m:"世代"},
    {k:"一家", r:"いっか", m:"全家"},
    {k:"親孝行", r:"おやこうこう", m:"孝順"},
    {k:"懐かしい", r:"なつかしい", m:"懷念的"},
    {k:"姉妹", r:"しまい", m:"姊妹"},
    {k:"末っ子", r:"すえっこ", m:"老么"},
    {k:"一人っ子", r:"ひとりっこ", m:"獨生子"},
    {k:"双子", r:"ふたご", m:"雙胞胎"},
    {k:"仲良し", r:"なかよし", m:"好朋友/關係好"},
    {k:"お嬢ちゃん", r:"おじょうちゃん", m:"令嬡/小姐"},
    {k:"お坊ちゃん", r:"おぼうちゃん", m:"少爺/令郎"},
    {k:"夫妻", r:"ふさい", m:"夫妻"},
    {k:"職場", r:"しょくば", m:"職場"},
    {k:"同い年", r:"おないどし", m:"同年齡"},
    {k:"気遣い", r:"きづかい", m:"費心/顧慮"},
    {k:"握手", r:"あくしゅ", m:"握手"},
    {k:"お辞儀", r:"おじぎ", m:"鞠躬"},
    
    // === 性格與狀態 (Part 2) ===
    {k:"長年", r:"ながねん", m:"多年"},
    {k:"些とも", r:"ちっとも", m:"一點也(不)"},
    {k:"丸で", r:"まるで", m:"簡直/完全"},
    {k:"特徴", r:"とくちょう", m:"特徵"},
    {k:"対になる", r:"ついになる", m:"成對"},
    {k:"積極的", r:"せっきょくてき", m:"積極的"},
    {k:"消極的", r:"しょうきょくてき", m:"消極的"},
    {k:"大人しい", r:"おとなしい", m:"文靜的/乖巧的"},
    {k:"喧しい", r:"やかましい", m:"吵鬧的/嚴格的"},
    {k:"慎重な", r:"しんちょうな", m:"慎重的"},
    {k:"粗忽", r:"そそっかしい", m:"冒失的/粗心的"},
    {k:"不器用", r:"ぶきような", m:"笨拙的"},
    {k:"要領がいい", r:"ようりょうがいい", m:"精明的/會抓要領的"},
    {k:"謙虚な", r:"けんきょな", m:"謙虛的"},
    {k:"生意気な", r:"なまいきな", m:"傲慢的/自大的"},
    {k:"鋭い", r:"するどい", m:"敏銳的/鋒利的"},
    {k:"鈍い", r:"にぶい", m:"遲鈍的/鈍的"},
    {k:"きびきび", r:"はきはき", m:"乾脆的/活潑的"},
    {k:"純粋な", r:"じゅんすいな", m:"純粹的"},
    {k:"穏やかな", r:"おだやかな", m:"平穩的/溫和的"},
    {k:"長所", r:"ちょうしょ", m:"優點"},
    {k:"短所", r:"たんしょ", m:"缺點"},
    {k:"厚かましい", r:"あつかまし", m:"厚臉皮的"},
    {k:"図々しい", r:"ずうずうしい", m:"厚顏無恥的"},
    {k:"吝嗇", r:"けちな", m:"小氣的"},
    {k:"平気", r:"へいき", m:"不在乎/沒事"},
    {k:"裏切る", r:"うらぎる", m:"背叛"},
    {k:"巫山戯る", r:"ふざける", m:"開玩笑/戲弄"},
    {k:"飽きる", r:"あきる", m:"厭煩/膩"},
    {k:"飽きっぽい", r:"あきっぽい", m:"沒耐性的/三分鐘熱度"},
    {k:"慌てる", r:"あわてる", m:"驚慌/慌張"},
    {k:"呑気な", r:"のんきな", m:"悠閒的/漫不經心的"},
    {k:"暢んびり", r:"のんびり", m:"悠閒自在"},
    {k:"率直", r:"そっちょく", m:"率直/坦率"},
    {k:"ドキドキ", r:"どきどき", m:"心跳/緊張"},
    {k:"イライラ", r:"いらいら", m:"焦躁/煩躁"},
    {k:"気楽に", r:"きらくに", m:"輕鬆地/隨意地"},
    {k:"焦る", r:"あせる", m:"焦急/急躁"},
    {k:"機嫌", r:"きげん", m:"心情/情緒"},
    {k:"清潔な", r:"せいけつな", m:"清潔的"},
    {k:"不潔な", r:"ふけつな", m:"不潔的"},
    {k:"見掛け", r:"みかけ", m:"外表/外觀"},
    {k:"地味な", r:"じみな", m:"樸素的"},
    {k:"態と", r:"わざと", m:"故意的"},
    {k:"一切", r:"いっさい", m:"一切/全都(不)"},
    {k:"滅多に", r:"めっきり", m:"急劇地/明顯地"},
    {k:"相変わらず", r:"あいかわらず", m:"照舊/依然"},
    {k:"狡い", r:"ずるい", m:"狡猾的"},
    {k:"味方", r:"みかた", m:"夥伴/我方"},
    {k:"悄っそり", r:"こっそり", m:"偷偷地/悄悄地"},

    // === 動詞與其他 (Part 2) ===
    {k:"疑う", r:"うたがう", m:"懷疑"},
    {k:"敬う", r:"うやまう", m:"尊敬"},
    {k:"羨む", r:"うらやむ", m:"羨慕"},
    {k:"悩む", r:"なやむ", m:"煩惱"},
    {k:"失望する", r:"しつぼうする", m:"失望"},
    {k:"ガッカリ", r:"がっかり", m:"失望/灰心"},
    {k:"羨ましい", r:"うらやましい", m:"令人羨慕的"},
    {k:"気の毒", r:"きのどく", m:"可憐/遺憾"},
    {k:"謝る", r:"あやまる", m:"道歉"},
    {k:"慰める", r:"なぐさめる", m:"安慰"},
    {k:"罵る", r:"ののしる", m:"謾罵/責罵"},
    {k:"貶す", r:"けなす", m:"貶低/毀謗"},
    {k:"避ける", r:"さける", m:"避開/避免"},
    {k:"逃げる", r:"にげる", m:"逃跑"},
    {k:"忠告する", r:"ちゅうこくする", m:"忠告"},
    {k:"助言する", r:"じょげんする", m:"建議"},
    {k:"言い付ける", r:"いいつける", m:"吩咐/告狀"},
    {k:"結び付ける", r:"むすびつける", m:"結合/繫結"},
    {k:"自慢する", r:"じまんする", m:"自誇"},
    {k:"隠す", r:"かくす", m:"隱藏"},
    {k:"秘密", r:"ひみつ", m:"秘密"},
    {k:"誤解", r:"ごかい", m:"誤解"},
    {k:"解く", r:"とく", m:"解開/解除"},
    {k:"仲直り", r:"なかなおり", m:"和好"},
    {k:"作法", r:"さほう", m:"禮節"},
    {k:"上司", r:"じょうし", m:"上司"},
    {k:"服装", r:"ふくそう", m:"服裝"},
    {k:"見っともない", r:"みっともない", m:"不像樣的/丟臉的"},
    {k:"見かける", r:"みかける", m:"看到/偶然遇見"},
    {k:"冷める", r:"さめる", m:"變冷/熱情冷卻"},
    {k:"失恋", r:"しつれん", m:"失戀"},
    {k:"恋する", r:"こいする", m:"戀愛"},
    {k:"道徳", r:"どうとく", m:"道德"},
    
    // === 副詞 (Part 3) ===
    {k:"正に", r:"まさに", m:"正是/確實"},
    {k:"思い切って", r:"おもいきって", m:"下決心/大膽地"},
    {k:"漸く", r:"ようやく", m:"終於/總算"},
    {k:"何時の間にか", r:"いつのまにか", m:"不知不覺中"},

    // === 飲食與身體 (Part 2) ===
    {k:"食う", r:"くう", m:"吃 (粗俗)"},
    {k:"しゃぶる", r:"しゃぶる", m:"含/吸吮"},
    {k:"味わう", r:"あじわう", m:"品嚐/體驗"},
    {k:"嗅ぐ", r:"かぐ", m:"聞/嗅"},
    {k:"食欲", r:"しょくよく", m:"食慾"},
    {k:"湯飲み", r:"ゆのみ", m:"茶杯"},
    {k:"お盆", r:"おぼん", m:"托盤/盂蘭盆節"},
    {k:"栄養", r:"えいよう", m:"營養"},
    {k:"消化", r:"しょうか", m:"消化"},
    {k:"胃に凭れる", r:"いにもたれる", m:"胃不舒服/積食"},
    {k:"歓迎会", r:"かんげいかい", m:"歡迎會"},
    {k:"注ぎ合う", r:"つぎあう", m:"互相斟酒"},
    {k:"酔う", r:"よう", m:"喝醉"},
    {k:"二日酔い", r:"ふつかよい", m:"宿醉"},
    {k:"頭痛", r:"ずつう", m:"頭痛"},
    {k:"吐き気", r:"はきけ", m:"噁心/想吐"},
    {k:"吐く", r:"はく", m:"嘔吐/吐氣"},
    {k:"失う", r:"うしなう", m:"失去"},
    {k:"握る", r:"にぎる", m:"握/捏(壽司)"},
    {k:"贅沢", r:"ぜいたく", m:"奢侈"},
    {k:"粗末な", r:"そまつな", m:"粗糙的/簡慢的"},
    {k:"天然の", r:"てんねんの", m:"天然的"},
    {k:"貴重な", r:"きちょうな", m:"貴重的"},
    {k:"原産", r:"げんさん", m:"原產"},
    {k:"好みの味", r:"このみのあじ", m:"喜歡的味道"},

    // === 生活雜項 ===
    {k:"縫う", r:"ぬう", m:"縫"},
    {k:"柄", r:"がら", m:"花色/花樣"},
    {k:"模様", r:"もよう", m:"花紋/樣子"},
    {k:"縞模様", r:"しまもよう", m:"條紋"},
    {k:"雑巾", r:"ぞうきん", m:"抹布"},
    {k:"掃く", r:"はく", m:"掃(地) (家事)"},
    {k:"ピカピカ", r:"ぴかぴか", m:"閃閃發亮"},
    {k:"裏返す", r:"うらがえす", m:"翻過來"},
    {k:"畳む", r:"たたむ", m:"折疊"},
    {k:"炊事", r:"すいじ", m:"烹飪/炊事"},
    {k:"献立", r:"こんだて", m:"菜單/食譜"},
    {k:"熱する", r:"ねっする", m:"加熱"},
    {k:"加熱する", r:"かねつする", m:"加熱"},
    {k:"溶く", r:"とく", m:"溶化/攪拌(蛋)"},
    {k:"溶かす", r:"とかす", m:"溶解(固體)"},
    {k:"溶ける", r:"とける", m:"融化"},
    {k:"倉庫", r:"そうこ", m:"倉庫"},
    {k:"仕舞う", r:"しまう", m:"收拾/收進"},
    {k:"栓をする", r:"せんをする", m:"塞住/蓋栓"},
    {k:"黴", r:"かび", m:"黴菌"},
    {k:"生える", r:"はえる", m:"生長/長(黴)"},
    {k:"腐る", r:"くさる", m:"腐爛"},
    {k:"赤ん坊", r:"あかんぼう", m:"嬰兒"},
    {k:"着せる", r:"きせる", m:"給...穿"},
    {k:"撫でる", r:"なでる", m:"撫摸"},
    {k:"抱く", r:"だく", m:"抱 (擁抱)"},
    {k:"抱っこ", r:"だっこ", m:"抱 (小孩)"},
    {k:"抱く(怀)", r:"いだく", m:"懷抱(夢想/情感)"},
    {k:"抱える", r:"かかえる", m:"夾/抱/承擔(問題)"},
    {k:"背負う", r:"せおう", m:"背負"},
    {k:"おんぶ", r:"おんぶ", m:"背(小孩)"},
    {k:"構う", r:"かまう", m:"介意/理會"},
    {k:"暴れる", r:"あばれる", m:"大鬧/暴動"},
    {k:"零す", r:"こぼす", m:"弄灑/發牢騷"},
    {k:"零れる", r:"こぼれる", m:"灑出/溢出"},
    {k:"汚す", r:"よごす", m:"弄髒"},
    {k:"汚れる", r:"よごれる", m:"變髒"},
    {k:"水玉模様", r:"みずたまもよう", m:"圓點花紋"},
    {k:"却って", r:"かえって", m:"反而"},
    {k:"予め", r:"あらかじめ", m:"預先/事先"},
    {k:"ぐっと", r:"ぐっと", m:"更加/用力地"},

    // === 醫療與症狀 (Part 2) ===
    {k:"症状", r:"しょうじょう", m:"症狀"},
    {k:"崩す", r:"くずす", m:"弄壞(身體)/拆散(錢)"},
    {k:"罹る", r:"かかる", m:"罹患/得病"},
    {k:"伝染", r:"でんせん", m:"傳染"},
    {k:"染める", r:"そめる", m:"染(色/髮)"},
    {k:"骨折", r:"こっせつ", m:"骨折"},
    {k:"疲れ", r:"つかれ", m:"疲勞"},
    {k:"溜まる", r:"たまる", m:"累積"},
    {k:"揉む", r:"もむ", m:"揉/按摩"},
    {k:"白髪", r:"しらが", m:"白髮"},
    {k:"抜ける", r:"ぬける", m:"脫落/漏掉"},
    {k:"包帯", r:"ほうたい", m:"繃帶"},
    {k:"効く", r:"きく", m:"有效"},
    {k:"震える", r:"ふるえる", m:"發抖/震動"},
    {k:"苦痛", r:"くつう", m:"痛苦"},
    {k:"薬局", r:"やっきょく", m:"藥局"},
    {k:"患者", r:"かんじゃ", m:"患者"},
    {k:"診る", r:"みる", m:"診察/看病"},
    {k:"診察", r:"しんさつ", m:"診察"},
    {k:"診断", r:"しんだん", m:"診斷"},
    {k:"這う", r:"はう", m:"爬"},
    {k:"凭れる", r:"もたれる", m:"倚靠"},
    {k:"余分な", r:"よぶんな", m:"多餘的"},
    {k:"予防", r:"よぼう", m:"預防"},
    {k:"適度", r:"てきど", m:"適度"},
    {k:"徹夜", r:"てつや", m:"熬夜"},
    {k:"不足", r:"ふそく", m:"不足"},
    {k:"睡眠", r:"すいみん", m:"睡眠"},
    {k:"嚏", r:"くしゃみ", m:"打噴嚏"},
    {k:"吃逆", r:"しゃっくり", m:"打嗝"},
    {k:"欠伸", r:"あくび", m:"哈欠"},
    {k:"寿命", r:"じゅみょう", m:"壽命"},
    {k:"長生き", r:"ながいき", m:"長壽"},
    {k:"肌", r:"はだ", m:"皮膚"},
    {k:"剃刀", r:"かみそり", m:"刮鬍刀"},
    {k:"髭", r:"ひげ", m:"鬍鬚"},
    {k:"剃る", r:"そる", m:"刮(鬍子)"},
    {k:"櫛", r:"くし", m:"梳子"},
    {k:"梳く", r:"とく", m:"梳(頭髮)"},
    {k:"立ち上がる", r:"たちあがる", m:"站起來/啟動"},
    {k:"飛び上がる", r:"とびあがる", m:"跳起來"},
    {k:"一応", r:"いちおう", m:"暫且/大致上"},
    {k:"忽ち", r:"たちまち", m:"轉瞬間/立刻"},
    {k:"今に", r:"いまに", m:"早晚/即將"},

    // === 競技與藝術 (Part 2) ===
    {k:"活躍", r:"かつやく", m:"活躍"},
    {k:"従う", r:"したがう", m:"遵從/跟隨"},
    {k:"選手", r:"せんしゅ", m:"選手"},
    {k:"攻める", r:"せめる", m:"攻擊"},
    {k:"勝負", r:"しょうぶ", m:"勝負/比賽"},
    {k:"勝敗", r:"しょうはい", m:"勝敗"},
    {k:"破る", r:"やぶる", m:"打破/打敗"},
    {k:"破れる", r:"やぶれる", m:"破掉/輸"},
    {k:"引き分け", r:"ひきわけ", m:"平手"},
    {k:"読書", r:"どくしょ", m:"讀書"},
    {k:"著者", r:"ちょしゃ", m:"作者"},
    {k:"書籍", r:"しょせき", m:"書籍"},
    {k:"目次", r:"もくじ", m:"目錄"},
    {k:"索引", r:"さくいん", m:"索引"},
    {k:"評論", r:"ひょうろん", m:"評論"},
    {k:"執筆", r:"しっぴつ", m:"執筆/寫作"},
    {k:"古典", r:"こてん", m:"古典"},
    {k:"訳す", r:"やくす", m:"翻譯"},
    {k:"小説", r:"しょうせつ", m:"小說"},
    {k:"傑作", r:"けっさく", m:"傑作"},
    {k:"名場面", r:"めいばめん", m:"名場面"},
    {k:"随筆", r:"ずいひつ", m:"隨筆/散文"},
    {k:"見つかる", r:"みつかる", m:"被發現/找到(自)"},
    {k:"粗筋", r:"あらすじ", m:"大綱/梗概"},
    {k:"演劇", r:"えんげき", m:"戲劇"},
    {k:"劇場", r:"げきじょう", m:"劇場"},
    {k:"芝居", r:"しばい", m:"戲劇/演技"},
    {k:"演技", r:"えんぎ", m:"演技"},
    {k:"主役", r:"しゅやく", m:"主角"},
    {k:"脇役", r:"わきやく", m:"配角"},
    {k:"舞台", r:"ぶたい", m:"舞台"},
    {k:"幕", r:"まく", m:"幕"},
    {k:"台詞", r:"せりふ", m:"台詞"},
    {k:"演奏", r:"えんそう", m:"演奏"},
    {k:"裁縫", r:"さいほう", m:"裁縫"},
    {k:"工芸", r:"こうげい", m:"工藝"},
    {k:"綿", r:"わた", m:"棉花"},
    {k:"詰める", r:"つめる", m:"塞滿/縮短"},
    {k:"削る", r:"けずる", m:"削/刪減"},
    {k:"彫る", r:"ほる", m:"雕刻"},
    
    // === 結尾與其他 ===
    {k:"若しかして", r:"もしかして", m:"莫非/該不會"},
    {k:"僅か", r:"わずか", m:"僅/少許"},
    {k:"実に", r:"じつに", m:"實在是/的確"},
    {k:"実は", r:"じつは", m:"其實/事實上"}
];

// ==========================================
// 系統核心邏輯
// ==========================================
let quizQueue = [];
let currentQuestion = null;
let totalLimit = 20; // 鎖定單次測驗 20 題
let questionCount = 0;
let isProcessing = false;

function startQuiz() {
    // 檢查單字庫是否足夠 (至少需要 2 個單字才能分配題型)
    if (rawData.length < 2) {
        alert("單字庫太少，請至少輸入 2 個單字！");
        return;
    }
    
    // 1. 隨機選取單字
    let shuffledDB = [...rawData].sort(() => 0.5 - Math.random());
    let sessionWords = shuffledDB.slice(0, Math.min(totalLimit, shuffledDB.length));
    
    // 2. 確定題數分配 (確保兩種題型比例為 50/50，若總題數非偶數，則意思題多一題)
    const totalWords = sessionWords.length;
    const numMeaning = Math.ceil(totalWords / 2); // 10 或 11
    const numReading = totalWords - numMeaning;    // 10 或 9

    // 3. 分割並分配題型
    let meaningWords = sessionWords.slice(0, numMeaning);
    let readingWords = sessionWords.slice(numMeaning);
    
    let meaningQuiz = meaningWords.map(word => ({ ...word, type: 1 }));
    let readingQuiz = readingWords.map(word => ({ ...word, type: 2 }));
    
    // 4. 合併並重新徹底打亂順序
    quizQueue = [...meaningQuiz, ...readingQuiz].sort(() => 0.5 - Math.random());

    // 5. 更新總題數顯示
    totalLimit = quizQueue.length;
    document.getElementById('progress-text').innerText = `第 1 / ${totalLimit} 題`;
    document.getElementById('score-text').innerText = `剩餘: ${totalLimit}`;

    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('quiz-screen').style.display = 'block';
    
    loadNextQuestion();
}

function loadNextQuestion() {
    if (quizQueue.length === 0) {
        showResult();
        return;
    }

    currentQuestion = quizQueue.shift(); 
    questionCount++;
    
    // 更新狀態列
    document.getElementById('progress-text').innerText = `目前進度: 第 ${questionCount} 關`;
    document.getElementById('score-text').innerText = `剩餘題數: ${quizQueue.length + 1}`;
    
    // 清除回饋
    const fb = document.getElementById('feedback');
    fb.innerText = "";
    fb.className = "feedback-msg";

    renderUI(currentQuestion);
    isProcessing = false;
}

function renderUI(q) {
    const qTag = document.getElementById('q-tag');
    const qText = document.getElementById('q-text');
    const optionsBox = document.getElementById('options-box');
    optionsBox.innerHTML = ''; 

    let correctAnswer = "";
    let distractors = [];

    if (q.type === 1) {
        // === 意思測驗 (type 1) ===
        qTag.innerText = "請選出中文意思";
        qTag.style.background = "#4f46e5"; // Blue
        qText.innerText = q.k || q.r; 
        correctAnswer = q.m;

        // 隨機干擾 (意思)
        let otherWords = rawData.filter(w => w.m !== q.m);
        distractors = otherWords.sort(() => 0.5 - Math.random()).slice(0, 3).map(w => w.m);

    } else {
        // === 讀音測驗 (type 2) ===
        qTag.innerText = "請選出正確讀音";
        qTag.style.background = "#d97706"; // Orange
        qText.innerText = q.k;
        correctAnswer = q.r;

        // 生成讀音干擾
        distractors = generateKanaDistractors(q.r);
    }

    let allOptions = [correctAnswer, ...distractors];
    // 補足選項至4個 (防止資料庫太少時出錯)
    while(allOptions.length < 4) allOptions.push("---");
    allOptions.sort(() => 0.5 - Math.random());

    allOptions.forEach(opt => {
        let btn = document.createElement('button');
        btn.className = 'opt-btn';
        
        // 將 "/" 替換為換行符號 <br>
        btn.innerHTML = opt.replace(/\s*\/\s*/g, '<br>');
        
        btn.onclick = () => checkAnswer(btn, opt, correctAnswer);
        optionsBox.appendChild(btn);
    });
}

// 產生讀音干擾項 (長音/促音/濁音 陷阱)
function generateKanaDistractors(correct) {
    let set = new Set();
    let limit = 0;
    
    while(set.size < 3 && limit < 20) {
        let fake = correct;
        let mode = Math.floor(Math.random() * 4);
        
        // 確保至少有兩個字元才進行變化
        if(correct.length > 1) {
            if (mode === 0) { // 長音
                if (fake.endsWith('う')) fake = fake.slice(0,-1);
                else if (fake.endsWith('い') || fake.endsWith('え') || fake.endsWith('お')) fake += 'う';
                else fake += 'う';
            } else if (mode === 1) { // 促音
                if(fake.includes('っ')) fake = fake.replace('っ','');
                else {
                    let pos = 1 + Math.floor(Math.random() * (fake.length - 1));
                    fake = fake.slice(0, pos) + 'っ' + fake.slice(pos);
                }
            } else if (mode === 2) { // 濁音
                const replacements = {'か':'が', 'き':'ぎ', 'く':'ぐ', 'け':'げ', 'こ':'ご', 'さ':'ざ', 'し':'じ', 'す':'ず', 'せ':'ぜ', 'そ':'ぞ', 'た':'だ', 'ち':'ぢ', 'つ':'づ', 'て':'で', 'と':'ど', 'は':'ば'};
                let chars = fake.split('');
                for(let i=0; i<chars.length; i++) {
                    if(replacements[chars[i]] && Math.random() > 0.6) {
                        chars[i] = replacements[chars[i]];
                        break;
                    }
                }
                fake = chars.join('');
            } else { // 隨機替換
                 let pos = Math.floor(Math.random() * fake.length);
                 let chars = "あいうえおかきくけこさしすせそたちつてとなにぬねの";
                 fake = fake.substring(0, pos) + chars[Math.floor(Math.random()*chars.length)] + fake.substring(pos+1);
            }
        }

        if(fake !== correct && fake.length > 0) set.add(fake);
        limit++;
    }
    
    // 若演算法產生不足，補隨機單字讀音
    if(set.size < 3) {
        let others = rawData.filter(w => w.r !== correct);
        others.forEach(w => { if(set.size<3) set.add(w.r); });
    }
    return Array.from(set);
}

function checkAnswer(btn, selected, correct) {
    if (isProcessing) return;
    isProcessing = true;
    
    const fb = document.getElementById('feedback');
    let allBtns = document.querySelectorAll('.opt-btn');

    if (selected === correct) {
        btn.classList.add('correct');
        fb.innerText = "⭕ 正確！";
        fb.style.color = "#10b981";
        setTimeout(loadNextQuestion, 800);
    } else {
        btn.classList.add('wrong');
        fb.innerText = "❌ 錯誤！";
        fb.style.color = "#ef4444";
        
        // 顯示正確答案
        allBtns.forEach(b => {
            // 由於選項內容被轉換成了innerHTML，所以需要用innerHTML進行比對
            if(b.innerHTML === correct.replace(/\s*\/\s*/g, '<br>')) {
                b.classList.add('correct');
            }
        });

        // 錯誤懲罰：加回隊列
        quizQueue.push(currentQuestion);
        document.getElementById('score-text').innerText = `剩餘題數: ${quizQueue.length}`;

        setTimeout(loadNextQuestion, 2000);
    }
}

function showResult() {
    document.getElementById('quiz-screen').style.display = 'none';
    document.getElementById('result-screen').style.display = 'block';
}
</script>
</body>
</html>
